<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>アファメーションカレンダー</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/screens.css">
  <link rel="stylesheet" href="css/stats.css">
  
  <style>
    /* SVGアイコン用のスタイル */
    .svg-icon {
      display: inline-block;
      width: 1em;
      height: 1em;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      vertical-align: -0.125em;
    }
    
    /* タイトルのキラキラアニメーション */
    h1 .svg-icon {
      animation: sparkle 2s ease-in-out infinite;
    }
    
    @keyframes sparkle {
      0%, 100% { 
        opacity: 1; 
        transform: rotate(0deg) scale(1); 
      }
      50% { 
        opacity: 0.7; 
        transform: rotate(180deg) scale(1.1); 
      }
    }
    
    /* 気分アイコンのサイズ調整 */
    .mood-icon .svg-icon {
      width: 2.5em;
      height: 2.5em;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 設定画面 -->
    <div id="setupScreen" class="screen">
      <h1>
        <svg class="svg-icon" viewBox="0 0 24 24" style="width: 1.2em; height: 1.2em;">
          <path d="M12 3v18M3 12h18M6 6l12 12M6 18L18 6"/>
        </svg>
        アファメーションカレンダー
      </h1>
      <p class="subtitle">あなたの心に響く言葉を、毎日音読しましょう</p>
      
      <div class="setup-card">
        <div class="form-group">
          <label>あなたの名前</label>
          <input type="text" id="studentNameInput" placeholder="例：田中太郎">
        </div>

        <div class="form-group">
          <label>今週の気分は？</label>
          <div class="mood-grid" id="moodGrid">
            <button class="mood-btn" data-mood="gentle">
              <span class="mood-icon">
                <svg class="svg-icon" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 1 1 4.5 4.5 4.5 4.5 0 1 1-4.5 4.5"/>
                </svg>
              </span>
              <span class="mood-label">Gentle</span>
              <span class="mood-desc">優しく</span>
            </button>
            <button class="mood-btn" data-mood="uplifting">
              <span class="mood-icon">
                <svg class="svg-icon" viewBox="0 0 24 24">
                  <path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09zM12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/>
                  <path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/>
                </svg>
              </span>
              <span class="mood-label">Uplifting</span>
              <span class="mood-desc">前向きに</span>
            </button>
            <button class="mood-btn" data-mood="empowering">
              <span class="mood-icon">
                <svg class="svg-icon" viewBox="0 0 24 24">
                  <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
              </span>
              <span class="mood-label">Empowering</span>
              <span class="mood-desc">力強く</span>
            </button>
            <button class="mood-btn" data-mood="balanced">
              <span class="mood-icon">
                <svg class="svg-icon" viewBox="0 0 24 24">
                  <path d="M12 3v18M3 12h18M6 6l12 12M6 18L18 6"/>
                </svg>
              </span>
              <span class="mood-label">Balanced</span>
              <span class="mood-desc">ミックス</span>
            </button>
          </div>
        </div>

        <div class="form-group">
          <label>難易度</label>
          <div class="level-grid" id="levelGrid">
            <button class="level-btn" data-level="easy">
              <span>初級</span>
              <small>英検5級/4級</small>
            </button>
            <button class="level-btn" data-level="intermediate">
              <span>中級</span>
              <small>英検3級</small>
            </button>
            <button class="level-btn" data-level="advanced">
              <span>上級</span>
              <small>英検準2級/2級</small>
            </button>
          </div>
          <p class="hint-text">
            <svg class="svg-icon" viewBox="0 0 24 24" style="width: 1em; height: 1em;">
              <circle cx="12" cy="12" r="10"/>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01"/>
            </svg>
            選択したムードの文が足りない場合は、同じレベル内の他のムードも含まれます
          </p>
        </div>

        <div class="form-group">
          <label>1日何文？</label>
          <div class="count-grid" id="countGrid">
            <button class="count-btn" data-count="1">1文</button>
            <button class="count-btn" data-count="2">2文</button>
            <button class="count-btn" data-count="3">3文</button>
          </div>
        </div>

        <button class="primary-btn" id="drawCardsBtn">
          <svg class="svg-icon" viewBox="0 0 24 24" style="width: 1em; height: 1em;">
            <path d="M12 3v18M3 12h18M6 6l12 12M6 18L18 6"/>
          </svg>
          今週のカードを引く
        </button>
      </div>
    </div>

    <!-- カレンダー画面 -->
    <div id="calendarScreen" class="screen" style="display: none;">
      <div class="header">
        <h2 id="weekRange"></h2>
        <div style="display: flex; gap: 0.5rem;">
          <button class="secondary-btn" id="statsBtn">
            <svg class="svg-icon" viewBox="0 0 24 24" style="width: 1em; height: 1em;">
              <line x1="12" y1="20" x2="12" y2="10"/>
              <line x1="18" y1="20" x2="18" y2="4"/>
              <line x1="6" y1="20" x2="6" y2="16"/>
            </svg>
            統計
          </button>
          <button class="secondary-btn" id="settingsBtn">
            <svg class="svg-icon" viewBox="0 0 24 24" style="width: 1em; height: 1em;">
              <circle cx="12" cy="12" r="3"/>
              <path d="M12 1v6m0 6v6m-7-7h6m2 0h6m-12.5 8.5l3.5-3.5m5 0l3.5 3.5m0-11l-3.5 3.5m-5 0L4.5 4.5"/>
            </svg>
            設定を変更
          </button>
        </div>
      </div>
      <div class="calendar-container" id="calendar"></div>
    </div>

    <!-- アファメーション画面 -->
    <div id="affirmationScreen" class="screen" style="display: none;">
      <div class="header">
        <button class="secondary-btn" id="backBtn">← 戻る</button>
        <h2 id="affirmationDate"></h2>
        <div style="width: 80px;"></div>
      </div>
      
      <div class="affirmation-container">
        <div class="affirmation-card">
          <div class="affirmation-text" id="affirmationText"></div>
          <div class="affirmation-japanese" id="affirmationJapanese" style="display: none;"></div>
          <button class="toggle-btn" id="toggleJapanese">日本語を表示</button>
        </div>

        <div class="audio-controls">
          <button class="audio-btn" id="playModelBtn">
            <span class="btn-icon">
              <svg class="svg-icon" viewBox="0 0 24 24" style="width: 1.2em; height: 1.2em;">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
              </svg>
            </span>
            <span>お手本を聞く</span>
          </button>
          <button class="audio-btn" id="recordBtn">
            <span class="btn-icon">
              <svg class="svg-icon" viewBox="0 0 24 24" style="width: 1.2em; height: 1.2em;">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v4M8 23h8"/>
              </svg>
            </span>
            <span>録音する</span>
          </button>
        </div>

        <div id="recordingPlayer" style="display: none;">
          <audio id="recordingAudio" controls></audio>
        </div>

        <div class="pagination" id="pagination"></div>

        <button class="primary-btn" id="completeBtn" style="display: none;">
          <svg class="svg-icon" viewBox="0 0 24 24" style="width: 1em; height: 1em;">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
          完了して送信
        </button>
      </div>
    </div>

    <!-- 統計画面 -->
    <div id="statsScreen" class="screen" style="display: none;">
      <div class="header">
        <button class="secondary-btn" id="backToCalendarBtn">← カレンダーに戻る</button>
        <h2>
          <svg class="svg-icon" viewBox="0 0 24 24" style="width: 1em; height: 1em;">
            <line x1="12" y1="20" x2="12" y2="10"/>
            <line x1="18" y1="20" x2="18" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="16"/>
          </svg>
          学習統計
        </h2>
        <div style="width: 120px;"></div>
      </div>
      
      <div class="calendar-container" id="statsContainer">
        <!-- 統計カードはJSで動的生成 -->
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { getStorage } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
    
    // グローバルにFirebaseを公開
    window.initializeApp = initializeApp;
    window.getFirestore = getFirestore;
    window.getStorage = getStorage;
  </script>

  <!-- アプリケーションJS（モジュール順に読み込み） -->
  <script src="js/firebase-config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/firebase-service.js"></script>
  <script src="js/stats.js"></script>
  <script src="js/calendar.js"></script>
  <script src="js/affirmation.js"></script>
  <script src="js/main.js"></script>
</body>
</html>