<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¢ãƒ•ã‚¡ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/screens.css">
  <link rel="stylesheet" href="css/stats.css">
  <link rel="stylesheet" href="css/animations.css">
  
  <style>
    /* SVGã‚¢ã‚¤ã‚³ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
    .icon {
      width: 24px;
      height: 24px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      display: inline-block;
      vertical-align: middle;
    }
    
    .icon-lg {
      width: 48px;
      height: 48px;
    }
    
    .icon-sm {
      width: 18px;
      height: 18px;
    }
    
    .icon-primary {
      stroke: #7b1fa2;
    }
    
    .icon-success {
      stroke: #4caf50;
    }
    
    .icon-white {
      stroke: white;
    }
    
    /* æ°—åˆ†ã‚¢ã‚¤ã‚³ãƒ³ */
    .mood-icon .icon {
      width: 40px;
      height: 40px;
      stroke: #7b1fa2;
    }
    
    /* ãƒœã‚¿ãƒ³å†…ã‚¢ã‚¤ã‚³ãƒ³ */
    button .icon {
      margin-right: 8px;
    }
    
    /* ã‚¿ã‚¤ãƒˆãƒ«ã‚¢ã‚¤ã‚³ãƒ³ */
    h1 .icon {
      margin-right: 12px;
      animation: sparkle 2s ease-in-out infinite;
    }
    
    @keyframes sparkle {
      0%, 100% { opacity: 1; transform: rotate(0deg) scale(1); }
      50% { opacity: 0.7; transform: rotate(180deg) scale(1.1); }
    }

    /* ãƒ‡ãƒãƒƒã‚°ç”¨ */
    .debug {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.8);
      color: lime;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 12px;
      max-width: 300px;
    }
  </style>
</head>
<body>

  <!-- ãƒ‡ãƒãƒƒã‚°è¡¨ç¤º -->
  <div class="debug" id="debug">
    <div>ğŸŸ¢ JavaScriptèª­ã¿è¾¼ã¿ä¸­...</div>
  </div>

  <!-- è¨­å®šç”»é¢ -->
  <div id="setupScreen" class="screen">
    <h1>
      <svg class="icon icon-lg icon-primary" viewBox="0 0 24 24">
        <path d="M12 3v18M3 12h18M6 6l12 12M6 18L18 6"/>
      </svg>
      ã‚¢ãƒ•ã‚¡ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
    </h1>
    <p class="subtitle">ã‚ãªãŸã®å¿ƒã«éŸ¿ãè¨€è‘‰ã‚’ã€æ¯æ—¥éŸ³èª­ã—ã¾ã—ã‚‡ã†</p>
    
    <div class="setup-card">
      <div class="form-group">
        <label>ã‚ãªãŸã®åå‰</label>
        <input type="text" id="studentNameInput" placeholder="ä¾‹ï¼šç”°ä¸­å¤ªéƒ">
      </div>

      <div class="form-group">
        <label>ä»Šé€±ã®æ°—åˆ†ã¯ï¼Ÿ</label>
        <div class="mood-grid" id="moodGrid">
          <button class="mood-btn" data-mood="gentle">
            <span class="mood-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 1 1 4.5 4.5 4.5 4.5 0 1 1-4.5 4.5"/>
              </svg>
            </span>
            <span class="mood-label">Gentle</span>
            <span class="mood-desc">å„ªã—ã</span>
          </button>
          <button class="mood-btn" data-mood="uplifting">
            <span class="mood-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09zM12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/>
                <path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/>
              </svg>
            </span>
            <span class="mood-label">Uplifting</span>
            <span class="mood-desc">å‰å‘ãã«</span>
          </button>
          <button class="mood-btn" data-mood="empowering">
            <span class="mood-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
              </svg>
            </span>
            <span class="mood-label">Empowering</span>
            <span class="mood-desc">åŠ›å¼·ã</span>
          </button>
          <button class="mood-btn" data-mood="balanced">
            <span class="mood-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M12 3v18M3 12h18M6 6l12 12M6 18L18 6"/>
              </svg>
            </span>
            <span class="mood-label">Balanced</span>
            <span class="mood-desc">ãƒŸãƒƒã‚¯ã‚¹</span>
          </button>
        </div>
      </div>

      <div class="form-group">
        <label>é›£æ˜“åº¦ã‚’é¸æŠ</label>
        <div class="level-grid" id="levelGrid">
          <button class="level-btn" data-level="beginner">
            <svg class="icon icon-lg" viewBox="0 0 24 24">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
            <span>åˆç´š</span>
          </button>
          <button class="level-btn" data-level="intermediate">
            <svg class="icon icon-lg" viewBox="0 0 24 24">
              <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
              <polyline points="17 6 23 6 23 12"/>
            </svg>
            <span>ä¸­ç´š</span>
          </button>
          <button class="level-btn" data-level="advanced">
            <svg class="icon icon-lg" viewBox="0 0 24 24">
              <path d="M6 3h12l4 6-10 13L2 9l4-6z"/>
            </svg>
            <span>ä¸Šç´š</span>
          </button>
        </div>
      </div>

      <div class="form-group">
        <label>1æ—¥ã®æ–‡æ•°</label>
        <div class="count-grid" id="countGrid">
          <button class="count-btn" data-count="1">1æ–‡</button>
          <button class="count-btn" data-count="2">2æ–‡</button>
          <button class="count-btn" data-count="3">3æ–‡</button>
        </div>
      </div>

      <button id="startBtn" class="btn-primary" disabled>
        <svg class="icon icon-white" viewBox="0 0 24 24">
          <path d="M12 3v18M3 12h18M6 6l12 12M6 18L18 6"/>
        </svg>
        ä»Šé€±ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆ
      </button>
    </div>
  </div>

  <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”»é¢ -->
  <div id="calendarScreen" class="screen" style="display: none;">
    <div class="header">
      <h2 id="weekTitle"></h2>
      <div class="header-buttons">
        <button id="statsBtn" class="icon-btn">
          <svg class="icon" viewBox="0 0 24 24">
            <line x1="12" y1="20" x2="12" y2="10"/>
            <line x1="18" y1="20" x2="18" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="16"/>
          </svg>
        </button>
        <button id="settingsBtn" class="icon-btn">
          <svg class="icon" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6m0 6v6m-7-7h6m2 0h6m-12.5 8.5l3.5-3.5m5 0l3.5 3.5m0-11l-3.5 3.5m-5 0L4.5 4.5"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="calendar-grid" id="calendarGrid"></div>
  </div>

  <!-- ã‚¢ãƒ•ã‚¡ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ -->
  <div id="affirmationScreen" class="screen" style="display: none;">
    <button id="backToCalendarBtn" class="back-btn">
      <svg class="icon icon-sm" viewBox="0 0 24 24">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
      ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æˆ»ã‚‹
    </button>

    <div class="affirmation-card">
      <div class="date-badge" id="affirmationDate"></div>
      
      <div id="affirmationContent"></div>

      <div class="controls">
        <button id="listenBtn" class="btn-secondary">
          <svg class="icon icon-white" viewBox="0 0 24 24">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
          </svg>
          ãŠæ‰‹æœ¬ã‚’èã
        </button>
        <button id="recordBtn" class="btn-primary">
          <svg class="icon icon-white" viewBox="0 0 24 24">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v4M8 23h8"/>
          </svg>
          éŒ²éŸ³ã™ã‚‹
        </button>
      </div>

      <div id="recordingsList"></div>

      <button id="completeBtn" class="btn-success" style="display: none;">
        <svg class="icon icon-white" viewBox="0 0 24 24">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
        å®Œäº†ã™ã‚‹
      </button>

      <button id="shareBtn" class="btn-share" style="display: none;">
        <svg class="icon icon-white" viewBox="0 0 24 24">
          <circle cx="18" cy="5" r="3"/>
          <circle cx="6" cy="12" r="3"/>
          <circle cx="18" cy="19" r="3"/>
          <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
          <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
        </svg>
        ã‚·ã‚§ã‚¢ã™ã‚‹
      </button>
    </div>
  </div>

  <!-- çµ±è¨ˆç”»é¢ -->
  <div id="statsScreen" class="screen" style="display: none;">
    <button id="backToCalendarFromStatsBtn" class="back-btn">
      <svg class="icon icon-sm" viewBox="0 0 24 24">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
      ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æˆ»ã‚‹
    </button>

    <h2>
      <svg class="icon icon-lg icon-primary" viewBox="0 0 24 24">
        <line x1="12" y1="20" x2="12" y2="10"/>
        <line x1="18" y1="20" x2="18" y2="4"/>
        <line x1="6" y1="20" x2="6" y2="16"/>
      </svg>
      çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    </h2>
    
    <div class="stats-grid" id="statsGrid"></div>
  </div>

  <!-- ã‚·ã‚§ã‚¢ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="shareModal" class="share-modal-overlay" style="display: none;">
    <div class="share-modal">
      <h3 class="share-modal-title">ã‚·ã‚§ã‚¢ã™ã‚‹</h3>
      <div class="share-buttons">
        <button class="share-option-btn" data-platform="twitter">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
          </svg>
          <span class="share-label">X (Twitter)</span>
        </button>
        <button class="share-option-btn" data-platform="facebook">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
          </svg>
          <span class="share-label">Facebook</span>
        </button>
        <button class="share-option-btn" data-platform="download">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
            <circle cx="12" cy="13" r="4"/>
          </svg>
          <span class="share-label">ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</span>
        </button>
        <button class="share-option-btn" data-platform="copy">
          <svg class="icon" viewBox="0 0 24 24">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
          </svg>
          <span class="share-label">ã‚³ãƒ”ãƒ¼</span>
        </button>
      </div>
      <button class="share-modal-close" onclick="closeShareModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
  </div>

  <!-- ç”»åƒç”Ÿæˆç”¨ã®Canvasï¼ˆéè¡¨ç¤ºï¼‰ -->
  <canvas id="shareCanvas" style="display: none;"></canvas>

  <!-- Firebase SDK -->
  <script type="module">
    const debugDiv = document.getElementById('debug');
    function addDebug(msg, color = 'lime') {
      const div = document.createElement('div');
      div.style.color = color;
      div.textContent = msg;
      debugDiv.appendChild(div);
      console.log(msg);
    }

    try {
      addDebug('ğŸŸ¢ Firebase SDKèª­ã¿è¾¼ã¿é–‹å§‹...');
      
      import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js')
        .then(({ initializeApp }) => {
          addDebug('âœ… firebase-app.js èª­ã¿è¾¼ã¿å®Œäº†');
          return import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js')
            .then(({ getFirestore }) => {
              addDebug('âœ… firebase-firestore.js èª­ã¿è¾¼ã¿å®Œäº†');
              return import('https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js')
                .then(({ getStorage }) => {
                  addDebug('âœ… firebase-storage.js èª­ã¿è¾¼ã¿å®Œäº†');
                  
                  const firebaseConfig = {
                    apiKey: "AIzaSyBMJZ89D_L8xSWFE_JbhAIEu08dGO3p5B8",
                    authDomain: "english-calendar.firebaseapp.com",
                    projectId: "english-calendar",
                    storageBucket: "english-calendar.firebasestorage.app",
                    messagingSenderId: "19266347001",
                    appId: "1:19266347001:web:ecd1dc1b7eb6d54a6e30d7"
                  };

                  const app = initializeApp(firebaseConfig);
                  window.db = getFirestore(app);
                  window.storage = getStorage(app);
                  
                  addDebug('âœ… FirebaseåˆæœŸåŒ–å®Œäº†');
                  
                  // JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’é †ç•ªã«èª­ã¿è¾¼ã‚€
                  loadScripts();
                });
            });
        })
        .catch(error => {
          addDebug('âŒ Firebaseèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + error.message, 'red');
        });
    } catch (error) {
      addDebug('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'red');
    }

    function loadScripts() {
      const scripts = [
        'js/affirmation.js',
        'js/calendar.js',
        'js/firebase-service.js',
        'js/stats.js',
        'js/utils.js',
        'js/main.js'
      ];

      let index = 0;

      function loadNext() {
        if (index >= scripts.length) {
          addDebug('ğŸ‰ å…¨ã¦ã®JavaScriptèª­ã¿è¾¼ã¿å®Œäº†ï¼');
          setTimeout(() => {
            debugDiv.style.display = 'none';
          }, 3000);
          return;
        }

        const script = document.createElement('script');
        script.src = scripts[index];
        
        script.onload = () => {
          addDebug(`âœ… ${scripts[index]} èª­ã¿è¾¼ã¿å®Œäº†`);
          index++;
          loadNext();
        };
        
        script.onerror = () => {
          addDebug(`âŒ ${scripts[index]} èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼`, 'red');
          index++;
          loadNext();
        };
        
        document.body.appendChild(script);
      }

      loadNext();
    }
  </script>

</body>
</html>