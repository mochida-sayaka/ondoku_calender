<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>アファメーションカレンダー</title>
  <link rel="icon" href="data:,">
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/screens.css">
  <link rel="stylesheet" href="css/stats.css">
  <link rel="stylesheet" href="css/animations.css">
  
  <style>
    /* SVGアイコン共通スタイル */
    .icon {
      width: 24px;
      height: 24px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      display: inline-block;
      vertical-align: middle;
    }
    
    .icon-lg {
      width: 48px;
      height: 48px;
    }
    
    .icon-sm {
      width: 18px;
      height: 18px;
    }
    
    .icon-primary {
      stroke: #7b1fa2;
    }
    
    .icon-success {
      stroke: #4caf50;
    }
    
    .icon-white {
      stroke: white;
    }
    
    /* 気分アイコン */
    .mood-icon .icon {
      width: 40px;
      height: 40px;
      stroke: #7b1fa2;
    }
    
    /* ボタン内アイコン */
    button .icon {
      margin-right: 8px;
    }
    
    /* タイトルアイコン */
    h1 .icon {
      margin-right: 12px;
      animation: sparkle 2s ease-in-out infinite;
    }
    
    @keyframes sparkle {
      0%, 100% { opacity: 1; transform: rotate(0deg) scale(1); }
      50% { opacity: 0.7; transform: rotate(180deg) scale(1.1); }
    }
  </style>
</head>
<body>

  <!-- 設定画面 -->
  <div id="setupScreen" class="screen">
    <h1>
      <svg class="icon icon-lg icon-primary" viewBox="0 0 24 24">
        <path d="M12 3v18M3 12h18M6 6l12 12M6 18L18 6"/>
      </svg>
      アファメーションカレンダー
    </h1>
    <p class="subtitle">あなたの心に響く言葉を、毎日音読しましょう</p>
    
    <div class="setup-card">
      <div class="form-group">
        <label>あなたの名前</label>
        <input type="text" id="studentNameInput" placeholder="例：田中太郎">
      </div>

      <div class="form-group">
        <label>今週の気分は？</label>
        <div class="mood-grid" id="moodGrid">
          <button class="mood-btn" data-mood="gentle">
            <span class="mood-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 1 1 4.5 4.5 4.5 4.5 0 1 1-4.5 4.5"/>
              </svg>
            </span>
            <span class="mood-label">Gentle</span>
            <span class="mood-desc">優しく</span>
          </button>
          <button class="mood-btn" data-mood="uplifting">
            <span class="mood-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09zM12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/>
                <path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/>
              </svg>
            </span>
            <span class="mood-label">Uplifting</span>
            <span class="mood-desc">前向きに</span>
          </button>
          <button class="mood-btn" data-mood="empowering">
            <span class="mood-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
              </svg>
            </span>
            <span class="mood-label">Empowering</span>
            <span class="mood-desc">力強く</span>
          </button>
          <button class="mood-btn" data-mood="balanced">
            <span class="mood-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M12 3v18M3 12h18M6 6l12 12M6 18L18 6"/>
              </svg>
            </span>
            <span class="mood-label">Balanced</span>
            <span class="mood-desc">ミックス</span>
          </button>
        </div>
      </div>

      <div class="form-group">
        <label>難易度を選択</label>
        <div class="level-grid" id="levelGrid">
          <button class="level-btn" data-level="beginner">
            <svg class="icon icon-lg" viewBox="0 0 24 24">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
            <span>初級</span>
          </button>
          <button class="level-btn" data-level="intermediate">
            <svg class="icon icon-lg" viewBox="0 0 24 24">
              <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
              <polyline points="17 6 23 6 23 12"/>
            </svg>
            <span>中級</span>
          </button>
          <button class="level-btn" data-level="advanced">
            <svg class="icon icon-lg" viewBox="0 0 24 24">
              <path d="M6 3h12l4 6-10 13L2 9l4-6z"/>
            </svg>
            <span>上級</span>
          </button>
        </div>
      </div>

      <div class="form-group">
        <label>1日の文数</label>
        <div class="count-grid" id="countGrid">
          <button class="count-btn" data-count="1">1文</button>
          <button class="count-btn" data-count="2">2文</button>
          <button class="count-btn" data-count="3">3文</button>
        </div>
      </div>

      <button id="startBtn" class="btn-primary" disabled>
        <svg class="icon icon-white" viewBox="0 0 24 24">
          <path d="M12 3v18M3 12h18M6 6l12 12M6 18L18 6"/>
        </svg>
        今週をスタート
      </button>
    </div>
  </div>

  <!-- カレンダー画面 -->
  <div id="calendarScreen" class="screen" style="display: none;">
    <div class="header">
      <h2 id="weekTitle"></h2>
      <div class="header-buttons">
        <button id="statsBtn" class="icon-btn">
          <svg class="icon" viewBox="0 0 24 24">
            <line x1="12" y1="20" x2="12" y2="10"/>
            <line x1="18" y1="20" x2="18" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="16"/>
          </svg>
        </button>
        <button id="settingsBtn" class="icon-btn">
          <svg class="icon" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6m0 6v6m-7-7h6m2 0h6m-12.5 8.5l3.5-3.5m5 0l3.5 3.5m0-11l-3.5 3.5m-5 0L4.5 4.5"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="calendar-grid" id="calendarGrid"></div>
  </div>

  <!-- アファメーション画面 -->
  <div id="affirmationScreen" class="screen" style="display: none;">
    <button id="backToCalendarBtn" class="back-btn">
      <svg class="icon icon-sm" viewBox="0 0 24 24">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
      カレンダーに戻る
    </button>

    <div class="affirmation-card">
      <div class="date-badge" id="affirmationDate"></div>
      
      <div id="affirmationContent"></div>

      <div class="controls">
        <button id="listenBtn" class="btn-secondary">
          <svg class="icon icon-white" viewBox="0 0 24 24">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
          </svg>
          お手本を聞く
        </button>
        <button id="recordBtn" class="btn-primary">
          <svg class="icon icon-white" viewBox="0 0 24 24">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v4M8 23h8"/>
          </svg>
          録音する
        </button>
      </div>

      <div id="recordingsList"></div>

      <button id="completeBtn" class="btn-success" style="display: none;">
        <svg class="icon icon-white" viewBox="0 0 24 24">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
        完了する
      </button>

      <button id="shareBtn" class="btn-share" style="display: none;">
        <svg class="icon icon-white" viewBox="0 0 24 24">
          <circle cx="18" cy="5" r="3"/>
          <circle cx="6" cy="12" r="3"/>
          <circle cx="18" cy="19" r="3"/>
          <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
          <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
        </svg>
        シェアする
      </button>
    </div>
  </div>

  <!-- 統計画面 -->
  <div id="statsScreen" class="screen" style="display: none;">
    <button id="backToCalendarFromStatsBtn" class="back-btn">
      <svg class="icon icon-sm" viewBox="0 0 24 24">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
      カレンダーに戻る
    </button>

    <h2>
      <svg class="icon icon-lg icon-primary" viewBox="0 0 24 24">
        <line x1="12" y1="20" x2="12" y2="10"/>
        <line x1="18" y1="20" x2="18" y2="4"/>
        <line x1="6" y1="20" x2="6" y2="16"/>
      </svg>
      統計ダッシュボード
    </h2>
    
    <div class="stats-grid" id="statsGrid"></div>
  </div>

  <!-- シェアモーダル -->
  <div id="shareModal" class="share-modal-overlay" style="display: none;">
    <div class="share-modal">
      <h3 class="share-modal-title">シェアする</h3>
      <div class="share-buttons">
        <button class="share-option-btn" data-platform="twitter">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
          </svg>
          <span class="share-label">X (Twitter)</span>
        </button>
        <button class="share-option-btn" data-platform="facebook">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
          </svg>
          <span class="share-label">Facebook</span>
        </button>
        <button class="share-option-btn" data-platform="download">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
            <circle cx="12" cy="13" r="4"/>
          </svg>
          <span class="share-label">画像をダウンロード</span>
        </button>
        <button class="share-option-btn" data-platform="copy">
          <svg class="icon" viewBox="0 0 24 24">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
          </svg>
          <span class="share-label">コピー</span>
        </button>
      </div>
      <button class="share-modal-close" onclick="closeShareModal()">キャンセル</button>
    </div>
  </div>

  <!-- 画像生成用のCanvas（非表示） -->
  <canvas id="shareCanvas" style="display: none;"></canvas>

  <!-- Firebase SDK & JavaScript（順番に読み込み） -->
  <script type="module">
    // Firebase SDKを読み込んで初期化
    import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js')
      .then(({ initializeApp }) => {
        return import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js')
          .then(({ getFirestore }) => {
            return import('https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js')
              .then(({ getStorage }) => {
                const firebaseConfig = {
                  apiKey: "AIzaSyBMJZ89D_L8xSWFE_JbhAIEu08dGO3p5B8",
                  authDomain: "english-calendar.firebaseapp.com",
                  projectId: "english-calendar",
                  storageBucket: "english-calendar.firebasestorage.app",
                  messagingSenderId: "19266347001",
                  appId: "1:19266347001:web:ecd1dc1b7eb6d54a6e30d7"
                };

                const app = initializeApp(firebaseConfig);
                window.db = getFirestore(app);
                window.storage = getStorage(app);
                
                // JavaScriptファイルを順番に読み込む
                loadScripts();
              });
          });
      });

    function loadScripts() {
      const scripts = [
        'js/affirmation.js',
        'js/calendar.js',
        'js/firebase-service.js',
        'js/stats.js',
        'js/utils.js',
        'js/main.js'
      ];

      let index = 0;

      function loadNext() {
        if (index >= scripts.length) {
          return;
        }

        const script = document.createElement('script');
        script.src = scripts[index];
        
        script.onload = () => {
          index++;
          loadNext();
        };
        
        script.onerror = () => {
          console.error(`Failed to load: ${scripts[index]}`);
          index++;
          loadNext();
        };
        
        document.body.appendChild(script);
      }

      loadNext();
    }
  </script>

</body>
</html>